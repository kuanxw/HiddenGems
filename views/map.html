<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<!-- If IE use the latest rendering engine -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<!-- Set the page to the width of the device and set the zoom level -->
	<meta name="viewport" content="width = device-width, initial-scale = 1">
	<meta name="description" content="Find places that are truly rewarding in your local area">
	<meta name="author" content="Kyle Wong">

	<title>Hidden Gems</title>

	<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css"
	      href="https://fonts.googleapis.com/css?family=Roboto|Josefin+Sans|Droid+Sans|Ubuntu">
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<link rel="stylesheet" type="text/css" href="css/map.css">
	<style>
		#map {
        	height: 400px;
        	width: 70%;
        	margin: auto;
    	}
  </style>
</head>


<body>
	<nav class="my-navbar navbar navbar-inverse navbar-fixed-top">
		<div class="container-fluid">
 		   <div class="navbar-header">
   		 	  <a class="navbar-brand" href="/">
   		 	  	<img src="img/logo.png" class="pic">
          </a>
    		</div>
    		<ul class="nav navbar-nav navbar-right">
    		  <li><a href="/map" class="button">Map</a></li>
    		  <li><a href="/profile" class="button">Profile</a></li>
    		</ul>
		</div>
	</nav>
	<h2 class="map-title">Points of Interest</h2>
	<div id="map"></div>
	<div id="poi">
		<p id="poi-name"></p>
		<p id="poi-rating"></p>
		<p id="poi-address"></p>
		<p id="poi-coordinates"></p>
	</div>

	<script src="https://www.gstatic.com/firebasejs/4.6.2/firebase.js"></script>
	<script src="https://www.gstatic.com/firebasejs/4.6.2/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/4.6.2/firebase-database.js"></script>
	<script>
		// Initialize Firebase
	  var config = {
	    apiKey: "AIzaSyAy6xB9KvplggjQUNA1Bk28M4adiDeOn8Y",
	    authDomain: "hiddengems-185818.firebaseapp.com",
	    databaseURL: "https://hiddengems-185818.firebaseio.com",
	    // projectId: "hiddengems-185818",
	    storageBucket: "",
	    messagingSenderId: "865980313875"
	  };
	  firebase.initializeApp(config);
	  var database = firebase.database();

      var map;
      var markers = [];
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 14,
          center: new google.maps.LatLng(34.0635,-118.4455),
          // mapTypeId: 'terrain'
        });

        // Create a <script> tag and set the USGS URL as the source.
        var script = document.createElement('script');
        // This example uses a local copy of the GeoJSON stored at
        // http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_week.geojsonp
        script.src = 'js/poi.js';
        document.getElementsByTagName('head')[0].appendChild(script);
      }
      /*
      function renderInfo(e) {
      	document.getElementById("poi-name").innerHTML = "Name: " + marker.name;
      }
      */

      function renderInfo(marker, name, rating, address, latitude, longitude) {
      	marker.addListener('click', ()=> {
	      	document.getElementById("poi-name").innerHTML = "Name: " + name;
	      	document.getElementById("poi-rating").innerHTML = "Rating: " + rating;
	      	document.getElementById("poi-address").innerHTML = "Address: " + address;
	      	let coordinates = latitude + ", " + longitude;
	      	document.getElementById("poi-coordinates").innerHTML = "Coordinates: " + coordinates;
	    });
      }

      // var addr = database.ref("/features").once('value').then(function(s){
      		// console.log(s.val());
      // });

/*
      database.ref('/features/' + 0 + '/address').once('value').then(function(s) {
      	console.log(s.val());
      });
      */

      database.ref('/features/').once('value', function(snapshot) {
  		snapshot.forEach(function(childSnapshot) {
	    	var childKey = childSnapshot.key;
	    	console.log("Child key", childKey);
	    	var childData = childSnapshot.val();
	    	console.log(childData);
	      var coords = childData.coordinates;
          var POIname = childData.name;
          var POIrating = childData.rating;
          var POIaddress = childData.address;
          var POIlatitude = coords.x;
          var POIlongitude = coords.y;
          var latLng = new google.maps.LatLng(POIlatitude, POIlongitude);
          var marker = new google.maps.Marker({
          	position: latLng,
	        map: map,
	      });
	      renderInfo(marker, POIname, POIrating, POIaddress, POIlatitude, POIlongitude);
          markers.push(marker);
        });
        google.maps.event.addListener(map, 'zoom_changed', () => {
	        for(var i = 0; i < markers.length; i++) {
	        	markers[i].setVisible(map.getZoom() >= 14);
	        }
      	});
	});

    // database.ref('/').set({
    //   username: "name",
    //   email: "email"
    // });

      //alert(addr);

      // Loop through the results array and place a marker for each
      // set of coordinates.
      /*
      window.eqfeed_callback = function(results) {
        for (var i = 0; i < results.features.length; i++) {
          var coords = results.features[i].coordinates;
          var POIname = results.features[i].name;
          var POIrating = 5;
          var POIaddress = results.features[i].address;
          var POIlatitude = results.features[i].coordinates[0];
          var POIlongitude = results.features[i].coordinates[1];
          var latLng = new google.maps.LatLng(coords[0],coords[1]);
          var marker = new google.maps.Marker({
          	position: latLng,
	        map: map,
	      });
	      renderInfo(marker, POIname, POIrating, POIaddress, POIlatitude, POIlongitude);
          	// alert("hello you clicked on me");
          markers.push(marker);
        }
        google.maps.event.addListener(map, 'zoom_changed', () => {
	        for(var i = 0; i < markers.length; i++) {
	        	markers[i].setVisible(map.getZoom() >= 14);
	        }
      	});
      } */
    </script>
	
    <script async defer
  		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC6gdpUvwoJeHyCvbCmhEpwnm0nwKZW6Vc&callback=initMap">
	</script>
</body>
</html>

